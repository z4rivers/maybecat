---
phase: 02-add-safety-net
plan: 02
type: execute
wave: 1
depends_on: []
files_modified: [src/pages/Home.tsx]
autonomous: true

must_haves:
  truths:
    - "Corrupted localStorage data doesn't crash the app"
    - "Invalid JSON in oracleShelterCat returns null instead of throwing"
    - "Site works exactly as before with valid localStorage data"
  artifacts:
    - path: "src/pages/Home.tsx"
      provides: "Safe localStorage parsing"
      contains: "try"
  key_links: []
---

<objective>
Add try-catch around localStorage JSON.parse operations.

Purpose: Prevent crashes when localStorage contains corrupted/invalid JSON data.
Output: Safe parsing that returns null on error instead of crashing.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

Relevant source files:
@src/pages/Home.tsx

The problematic code is at line 117-120:
```typescript
const [shelterCat, setShelterCat] = useState<ShelterCat | null>(() => {
  const stored = localStorage.getItem('oracleShelterCat');
  return stored ? JSON.parse(stored) : null;
});
```

If `stored` contains invalid JSON, `JSON.parse(stored)` will throw and crash the app.
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add try-catch to shelterCat initialization</name>
  <files>src/pages/Home.tsx</files>
  <action>Edit the useState initializer for shelterCat (around line 117-120) to wrap the JSON.parse in a try-catch:

  Change from:
  ```typescript
  const [shelterCat, setShelterCat] = useState<ShelterCat | null>(() => {
    const stored = localStorage.getItem('oracleShelterCat');
    return stored ? JSON.parse(stored) : null;
  });
  ```

  Change to:
  ```typescript
  const [shelterCat, setShelterCat] = useState<ShelterCat | null>(() => {
    try {
      const stored = localStorage.getItem('oracleShelterCat');
      return stored ? JSON.parse(stored) : null;
    } catch {
      return null;
    }
  });
  ```

  This ensures that if localStorage contains corrupted JSON, the app gracefully returns null instead of crashing. The user simply won't see their previously selected cat, which is acceptable recovery behavior.

  DO NOT add console.error or console.warn - keep it silent. The behavior should be invisible to users.</action>
  <verify>npm run build succeeds</verify>
  <done>JSON.parse wrapped in try-catch</done>
</task>

<task type="auto">
  <name>Task 2: Verify build passes</name>
  <files></files>
  <action>Run npm run build to verify everything compiles correctly.</action>
  <verify>npm run build exits with code 0</verify>
  <done>Build passes, no type errors</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] npm run build succeeds
- [ ] Home.tsx has try-catch around JSON.parse for shelterCat
- [ ] No other changes to Home.tsx behavior
</verification>

<success_criteria>

- All tasks completed
- All verification checks pass
- No errors or warnings introduced
- JSON.parse wrapped in try-catch
- Invalid JSON returns null instead of crashing
</success_criteria>

<output>
After completion, create `.planning/phases/02-add-safety-net/02-02-SUMMARY.md`
</output>
