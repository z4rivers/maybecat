# Plan 04-02: Extract useCatStorage hook

## Goal

Extract localStorage persistence logic for cat data into a reusable hook.

## Why

- localStorage logic is scattered across multiple callbacks
- Centralizing it makes persistence behavior easier to understand and modify
- Prepares for easier testing (Phase 6)

## Current localStorage Logic

**State initialization (lines 116-125):**
```typescript
const [catImage, setCatImage] = useState<string | null>(() => localStorage.getItem('oracleCatImage'));
const [catName, setCatName] = useState(() => localStorage.getItem('oracleCatName') || '');
const [shelterCat, setShelterCat] = useState<ShelterCat | null>(() => {
  try {
    const stored = localStorage.getItem('oracleShelterCat');
    return stored ? JSON.parse(stored) : null;
  } catch { return null; }
});
```

**handleImageUpload (lines 203-206):**
```typescript
localStorage.setItem('oracleCatImage', base64);
localStorage.removeItem('oracleShelterCat');
```

**handleNameSave (lines 213-215):**
```typescript
localStorage.setItem('oracleCatName', name);
```

**clearCat (lines 223-225):**
```typescript
localStorage.removeItem('oracleCatImage');
localStorage.removeItem('oracleCatName');
localStorage.removeItem('oracleShelterCat');
```

**selectShelterCat (lines 231-234):**
```typescript
localStorage.setItem('oracleCatImage', cat.photo);
localStorage.setItem('oracleCatName', cat.name);
localStorage.setItem('oracleShelterCat', JSON.stringify(cat));
```

## Proposed Hook Interface

```typescript
interface UseCatStorageReturn {
  catImage: string | null;
  catName: string;
  shelterCat: ShelterCat | null;
  setCatFromUpload: (image: string) => void;      // sets image, clears shelter cat
  setCatName: (name: string) => void;
  setCatFromShelter: (cat: ShelterCat) => void;   // sets all three
  clearCat: () => void;                           // clears all
}

function useCatStorage(): UseCatStorageReturn
```

## Tasks

### Task 1: Create src/hooks/useCatStorage.ts
- Create hook with state and localStorage sync
- Include try-catch for shelterCat parsing (already done)
- Export hook and return type

### Task 2: Update Home.tsx to use the hook
- Import useCatStorage
- Replace state declarations and localStorage calls
- Update callbacks to use hook functions
- Remove redundant state and localStorage code

### Task 3: Verify build passes
- Run `npm run build`
- Confirm no type errors

## Verification

- [ ] src/hooks/useCatStorage.ts exists
- [ ] Hook handles all localStorage keys: oracleCatImage, oracleCatName, oracleShelterCat
- [ ] Home.tsx uses hook instead of direct localStorage calls
- [ ] npm run build succeeds
- [ ] Cat persistence works (upload cat, refresh, cat still there)

## Notes

- Keep ShelterCat type import from rescueGroups
- Maintain try-catch safety from Phase 2
- Hook manages both React state AND localStorage sync
